<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>使用 Travis CI 自动部署 Hexo | EXP Notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="author" content="Levan">
  
  
    <meta name="description" content="日常记录与分享">
  
  
    <meta name="keywords" content="Travis CI自动部署工具,Hexo,自动部署Hexo到GitHub">
  
  
    <meta name="google-site-verification" content="W2AVg5n_ALo21rl9n3ZwS8AuEanZfJkirzrRGLLYvn4">
  
  
    <meta name="baidu-site-verification" content="BM2Q3xLpPJ">
  
  
    <meta name="360-site-verification" content="573211edf2de02c99d7b255b2c56513c">
  
  
    <link rel="short icon" type="image/x-icon" href="/Notes/css/images/favicon.ico">
  
  <link rel="canonical" href="https://evandoz.github.io/Notes/archives/720679b031c2.html">
  
<link rel="stylesheet" href="/Notes/css/style.css">

<meta name="generator" content="Hexo 5.3.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="overflow" class="overflow">
    <div id="hiddenbar" class="hiddenbar">
      <div id="wrapper" class="wrapper">
        <header id="header" class="header is-post">
  <div class="outer">
    <div class="logo">
      <a class="title" href="/Notes/">EXP Notes</a>
    </div>
    <div class="nav">
      <ul id="nav-icon" class="nav-icon">
        <li></li><li></li><li></li>
      </ul>
      <ul class="nav-menu">
        
          <li class="nav-item">
            <a href="/Notes/archives">归档</a>
          </li>
        
          <li class="nav-item">
            <a href="/Notes/categories">分类</a>
          </li>
        
          <li class="nav-item">
            <a href="/Notes/tags">标签</a>
          </li>
        
          <li class="nav-item">
            <a href="/Notes/about">关于</a>
          </li>
        
      </ul>
    </div>

  </div>
</header>

        <div id="content" class="content">
    <section class="article-header inner">
      <img src="/Notes/css/images/banner2.jpg" alt="banner">
      

      
  
  	<h1 class="post-title">使用 Travis CI 自动部署 Hexo</h1>
  


      <div class="post-meta">
        <span class="post-date">
  <time datetime="2016-08-26T16:00:00.000Z">2016-08-27</time>
</span>

        
  <span class="post-category">
    <a class="category-link" href="/Notes/categories/Hexo/">Hexo</a>
  </span>


      </div>
    </section>
    <section class="article-body inner">
      <div id="side" class="aside post left">

      </div>
      <div class="main">
        <article id="Hexo/20160827-使用 Travis CI 自动部署 Hexo" class="article">
          <div id="post-content" class="post-content">
            <p>由于<code>Hexo</code>系统本身的特性，每次都需要手动更新部署网站，于是拟利用软件开发中的持续集成工具<code>Travis CI</code>来帮助完成这一繁杂过程。</p>
<a id="more"></a>
<h2 id="Travis-CI"><a class="headerlink" href="#Travis-CI"></a>Travis CI</h2>
<hr>
<p>CI是<code>Continuous Integration</code>的缩写，持续集成之意。</p>
<blockquote>
<p>持续集成是一种软件开发实践，每次集成都通过自动化的构建（包括编译，发布，自动化测试）来验证，从而尽早地发现集成错误。</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/Evandoz/blob/master/Travis/Continuous.png" alt="Continuous Integration"><span class="caption">Continuous Integration</span></p>
<p>Travis CI 是目前新兴的开源持续集成构建项目，用来构建托管在<code>GitHub</code>上的代码。它提供了多种编程语言的支持，包括Ruby，JavaScript，Java，Scala，PHP，Haskell和Erlang在内的多种语言。许多知名的开源项目使用它来在每次提交的时候进行构建测试，比如Ruby on Rails，Ruby和Node.js。</p>
<blockquote>
<p>Travis CI是在软件开发领域中的一个在线的，分布式的持续集成服务，用来构建及测试在GitHub托管的代码。这个软件的代码同时也是开源的，可以在GitHub上下载到，尽管开发者当前并不推荐在闭源项目中单独使用它。</p>
</blockquote>
<h2 id="工作原理"><a class="headerlink" href="#工作原理"></a>工作原理</h2>
<hr>
<p>当我们每次进行<code>push</code>等动作时，Travis CI 会自动检测我们的提交，然后根据配置文件，搭建虚拟主机来运行测试，构建等指令。在这里，就是运行<code>hexo g d</code>等命令来自动生成、部署静态网页。</p>
<p><img src="https://raw.githubusercontent.com/Evandoz/blob/master/Travis/Travis.png" alt="Travis CI"><span class="caption">Travis CI</span></p>
<p>Travis CI 官方文档：<a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.travis-ci.com/">https://docs.travis-ci.com/</a></p>
<h2 id="具体配置"><a class="headerlink" href="#具体配置"></a>具体配置</h2>
<hr>
<h3 id="Hexo-搭建"><a class="headerlink" href="#Hexo-搭建"></a>Hexo 搭建</h3>
<p>这里使用<code>Hexo</code>+<code>Next</code>+<code>GitHub Pages</code>组合示范过程，具体过程不再赘述。网站源码放到<code>Hexo</code>分支，博客的静态文件部署到<code>master</code>分支。</p>
<p><img src="https://raw.githubusercontent.com/Evandoz/blob/master/Travis/Travis001.png" alt="hexo源代码"><span class="caption">hexo源代码</span></p>
<h3 id="设置-Travis-CI"><a class="headerlink" href="#设置-Travis-CI"></a>设置 Travis CI</h3>
<p>登陆 Travis CI，使用 GitHub 账户登录，它会自动关联 GitHub 上的仓库。点击右上角用户查看 GitHub 仓库，并选择要启动的项目，这里选择<code>yourname/yourname.github.io</code>。</p>
<p>点击设置按钮，进入设置选项，开启相关服务，<code>Build only if .travis.yml is present</code>：指只在有<code>.travis.yml</code>时改变了才构建；<code>Build pushes</code>：push 完分支后开始构建。</p>
<p><img src="https://raw.githubusercontent.com/Evandoz/blob/master/Travis/Travis005.png" alt="设置"><span class="caption">设置</span></p>
<p>访问仓库是需要权限的，下面配置权限信息。</p>
<h3 id="配置-Acess-Token"><a class="headerlink" href="#配置-Acess-Token"></a>配置 Acess Token</h3>
<p>登陆<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com">GitHub</a>，进入设置界面，在<code>Personal access tokens</code>页面下点击右上角的<code>Generate new token</code>按钮会生成新的<code>token</code>，随后输入密码，取个名字，勾选一些权限</p>
<p><img src="https://raw.githubusercontent.com/Evandoz/blob/master/Travis/Travis006.png" alt="Personal access tokens"><span class="caption">Personal access tokens</span></p>
<p>为了保护 token 的私密性，将其配置到 Travis CI 的<code>Environment Variables</code>。</p>
<p><img src="https://raw.githubusercontent.com/Evandoz/blob/master/Travis/Travis008.png" alt="Environment Variables"><span class="caption">Environment Variables</span></p>
<p>Travis CI 已获得仓库权限，现在可以给它相关操作指令了。</p>
<h3 id="配置-travis-yml"><a class="headerlink" href="#配置-travis-yml"></a>配置 .travis.yml</h3>
<p><em>.travis.yml</em> 内容如下：</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">language</span><span class="token punctuation">:</span> node_js  <span class="token comment">#设置语言</span>

<span class="token key atrule">node_js</span><span class="token punctuation">:</span> stable  <span class="token comment">#设置相应的版本</span>

<span class="token key atrule">install</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> npm install  <span class="token comment">#安装hexo及插件</span>

<span class="token key atrule">script</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> hexo cl  <span class="token comment">#清除</span>
  <span class="token punctuation">-</span> hexo g  <span class="token comment">#生成</span>

<span class="token key atrule">after_script</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> cd ./public
  <span class="token punctuation">-</span> git init
  <span class="token punctuation">-</span> git config user.name "yourname"  <span class="token comment">#修改name</span>
  <span class="token punctuation">-</span> git config user.email "youremail"  <span class="token comment">#修改email</span>
  <span class="token punctuation">-</span> git add .
  <span class="token punctuation">-</span> git commit <span class="token punctuation">-</span>m "update"
  <span class="token punctuation">-</span> git push <span class="token punctuation">-</span><span class="token punctuation">-</span>force <span class="token punctuation">-</span><span class="token punctuation">-</span>quiet "https<span class="token punctuation">:</span>//$<span class="token punctuation">&#123;</span>GH_TOKEN<span class="token punctuation">&#125;</span>@$<span class="token punctuation">&#123;</span>GH_REF<span class="token punctuation">&#125;</span>" master<span class="token punctuation">:</span>master  <span class="token comment">#GH_TOKEN是在Travis中配置token的名称</span>

<span class="token key atrule">branches</span><span class="token punctuation">:</span>
  <span class="token key atrule">only</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> hexo  <span class="token comment">#只监测hexo分支，hexo是我的分支的名称，可根据自己情况设置</span>
<span class="token key atrule">env</span><span class="token punctuation">:</span>
  <span class="token key atrule">global</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">GH_REF</span><span class="token punctuation">:</span> github.com/yourname/yourname.github.io.git  <span class="token comment">#设置GH_REF，注意更改yourname</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当然，为了个人隐私方面的考虑，<em>.travis.yml</em> 文件中的用户名、邮箱之类的变量也可以像 GH_TOKEN 一样定义在 Environment Variables 中。</p>
<p>需要注意一个问题是，创建虚拟机后，Travis 会使用<code>npm install</code>命令读取 package.json 文件来安装 Hexo 及其依赖文件，因此需要保证 package.json 文件不可少且相关的依赖文件都在其中有记录。</p>
<p><img src="https://raw.githubusercontent.com/Evandoz/blob/master/Travis/Travis009.png" alt="package.json"><span class="caption">package.json</span></p>
<p>配置Hexo时会生成<code>node_modules</code>文件夹，这是 Hexo 及其依赖包的位置，它和 <em>package.json</em> 文件列表是对应的。因此 node_modules 文件夹不需要 push 远程仓库，CI平台的虚拟机会自己创建的。</p>
<p>另外注意这些文件的<strong>格式</strong>，尤其是<code>.yml</code>的格式，稍有偏差就有可能出问题。</p>
<h3 id="Push-到-GitHub"><a class="headerlink" href="#Push-到-GitHub"></a>Push 到 GitHub</h3>
<p>在本地_posts目录下新建文章并 push 分支，登陆 Travis CI 即可看到已经检测到分支变化并开始构建，其中<code>job log</code>记录了构建的过程。</p>
<p><img src="https://raw.githubusercontent.com/Evandoz/blob/master/Travis/Travis013.png" alt="hexo deployer"><span class="caption">hexo deployer</span></p>
<p>自动部署完成，打开网页查看效果</p>
<p><img src="https://raw.githubusercontent.com/Evandoz/blob/master/Travis/Travis015.png" alt="post"><span class="caption">post</span></p>
<h2 id="参考资料"><a class="headerlink" href="#参考资料"></a>参考资料</h2>
<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://lotabout.me/2016/Hexo-Auto-Deploy-to-Github/">Hexo 自动部署到 Github</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://blog.csdn.net/woblog/article/details/51319364">手把手教你使用Travis CI自动部署你的Hexo博客到Github上</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://gold.xitu.io/entry/570de1f32e958a0069d567f6">使用 travis-ci 自动部署 hexo 博客</a></li>
</ul>

          </div>
          <div class="post-footer">
            <div class="post-copyright">&copy; 除特殊声明外，文章著作权归作者所有，转载请注明作者及出处</div>
          </div>
        </article>
        <!-- Pagination -->
        
          <div class="nagination card">
            
              <a href="/Notes/archives/70b5a7d0c967" class="nagination-link">上篇: CSS 引入方式与选择器</a>
            
            
              <a href="/Notes/archives/a014cdddb11c" class="nagination-link">下篇: 图的关节点问题</a>
            
          </div>
        
        <!-- Comment -->
        <!-- 
          <div id="article-comment" class="article-comment card"></div>

         -->
      </div>
      <div id="toc" class="toc">
        
          <ol class="toc-content"><li class="toc-content-item toc-content-level-2"><a class="toc-content-link" href="#Travis-CI"><span class="toc-content-text">Travis CI</span></a></li><li class="toc-content-item toc-content-level-2"><a class="toc-content-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-content-text">工作原理</span></a></li><li class="toc-content-item toc-content-level-2"><a class="toc-content-link" href="#%E5%85%B7%E4%BD%93%E9%85%8D%E7%BD%AE"><span class="toc-content-text">具体配置</span></a><ol class="toc-content-child"><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#Hexo-%E6%90%AD%E5%BB%BA"><span class="toc-content-text">Hexo 搭建</span></a></li><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#%E8%AE%BE%E7%BD%AE-Travis-CI"><span class="toc-content-text">设置 Travis CI</span></a></li><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#%E9%85%8D%E7%BD%AE-Acess-Token"><span class="toc-content-text">配置 Acess Token</span></a></li><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#%E9%85%8D%E7%BD%AE-travis-yml"><span class="toc-content-text">配置 .travis.yml</span></a></li><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#Push-%E5%88%B0-GitHub"><span class="toc-content-text">Push 到 GitHub</span></a></li></ol></li><li class="toc-content-item toc-content-level-2"><a class="toc-content-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-content-text">参考资料</span></a></li></ol>
        
      </div>
    </section>


</div>
        <footer id="footer" class="footer">
  <div class="outer">
    <div class="copyright">
      <p><span>EXP Notes</span> &copy; 2015 - 2022</p>
    </div>
    <div class="navigation">
      <a href="https://evandoz.github.io">Hexo · Levan</a>
    </div>
  </div>
</footer>

      </div>
    </div>
  </div>
  
  <div id="mobile-nav" class="mobile-nav">
  
    <a class="menu-item" href="/Notes/archives">归档</a>
  
    <a class="menu-item" href="/Notes/categories">分类</a>
  
    <a class="menu-item" href="/Notes/tags">标签</a>
  
    <a class="menu-item" href="/Notes/about">关于</a>
  
</div>

<div id="over-layer" class="over-layer"></div>

  
<script src="/Notes/js/jquery.js"></script>


<script src="/Notes/js/velocity.js"></script>


<script src="/Notes/js/plugins.js"></script>


<script src="/Notes/js/script.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->




</body>
</html>
