<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>使用 flow.ci 自动部署 Hexo | EXP Notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="author" content="Levan">
  
  
    <meta name="description" content="日常记录与分享">
  
  
    <meta name="keywords" content="flow.ci自动部署工具,Hexo,自动部署Hexo到Coding.net">
  
  
    <meta name="google-site-verification" content="W2AVg5n_ALo21rl9n3ZwS8AuEanZfJkirzrRGLLYvn4">
  
  
    <meta name="baidu-site-verification" content="BM2Q3xLpPJ">
  
  
    <meta name="360-site-verification" content="573211edf2de02c99d7b255b2c56513c">
  
  
    <link rel="short icon" type="image/x-icon" href="/Notes/css/images/favicon.ico">
  
  <link rel="canonical" href="https://evandoz.github.io/Notes/archives/8c8e157040aa.html">
  
<link rel="stylesheet" href="/Notes/css/style.css">

<meta name="generator" content="Hexo 5.3.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="overflow" class="overflow">
    <div id="hiddenbar" class="hiddenbar">
      <div id="wrapper" class="wrapper">
        <header id="header" class="header is-post">
  <div class="outer">
    <div class="logo">
      <a class="title" href="/Notes/">EXP Notes</a>
    </div>
    <div class="nav">
      <ul id="nav-icon" class="nav-icon">
        <li></li><li></li><li></li>
      </ul>
      <ul class="nav-menu">
        
          <li class="nav-item">
            <a href="/Notes/archives">归档</a>
          </li>
        
          <li class="nav-item">
            <a href="/Notes/categories">分类</a>
          </li>
        
          <li class="nav-item">
            <a href="/Notes/tags">标签</a>
          </li>
        
          <li class="nav-item">
            <a href="/Notes/about">关于</a>
          </li>
        
      </ul>
    </div>

  </div>
</header>

        <div id="content" class="content">
    <section class="article-header inner">
      <img src="/Notes/css/images/banner2.jpg" alt="banner">
      

      
  
  	<h1 class="post-title">使用 flow.ci 自动部署 Hexo</h1>
  


      <div class="post-meta">
        <span class="post-date">
  <time datetime="2016-11-18T16:00:00.000Z">2016-11-19</time>
</span>

        
  <span class="post-category">
    <a class="category-link" href="/Notes/categories/Hexo/">Hexo</a>
  </span>


      </div>
    </section>
    <section class="article-body inner">
      <div id="side" class="aside post left">

      </div>
      <div class="main">
        <article id="Hexo/20161119-使用 flow.ci 自动部署 Hexo" class="article">
          <div id="post-content" class="post-content">
            <p>国内持续集成工具<code>flow.ci</code>上线，尝试将其用于<code>Coding.net</code>仓库代码的构建与测试。</p>
<h2 id="认识-flow-ci"><a class="headerlink" href="#认识-flow-ci"></a>认识 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://flow.ci">flow.ci</a></h2>
<hr>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="http://flow.ci/">flow.ci</a> 采用工作流机制，功能与 Travis CI 差不多，被称为国内的 Travis CI。</p>
<blockquote>
<p>融入 Workflow 机制的持续集成，让代码在 Build, Test, Deploy 间轻盈灵动</p>
</blockquote>
<p>关于 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://flow.ci">flow.ci</a> 的更多介绍，可以访问其<a target="_blank" rel="external nofollow noopener noreferrer" href="http://blog.flow.ci/">官方博客</a>。</p>
<h2 id="配置步骤"><a class="headerlink" href="#配置步骤"></a>配置步骤</h2>
<hr>
<p>关于使用 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://flow.ci">flow.ci</a> 自动部署 Hexo 的方法，网上目前只在 Juglans’ Blog 中出现过。而作者提供的方法要把 id_rsa 文件放在博客源码中，如果使用 public 库，此法并不推荐。因为个人网站是双线托管，只拥有 GitHub public，于是要尝试新方法。</p>
<h3 id="注册-flow-ci"><a class="headerlink" href="#注册-flow-ci"></a>注册 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://flow.ci">flow.ci</a></h3>
<p>必要步骤，有兴趣可以去 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://flow.ci">flow.ci</a> 官网申请内测以获取邀请码。</p>
<p><img src="https://raw.githubusercontent.com/Evandoz/blob/master/flow.ci/flow.ci001.png" alt="flow.ci"><span class="caption">flow.ci</span></p>
<h3 id="创建项目"><a class="headerlink" href="#创建项目"></a>创建项目</h3>
<p>在 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://flow.ci">flow.ci</a> 拉取仓库源码，创建相应的项目进行自动部署，<a target="_blank" rel="external nofollow noopener noreferrer" href="http://flow.ci">flow.ci</a> de工作流机制让操作变得简单。</p>
<p>具体的按照下面的顺序操作即可：<br>
创建项目 -&gt; 选择代码源 -&gt; 选择用户 -&gt; 选择仓库 -&gt; 创建工作流 -&gt; 选择脚本模板。</p>
<p><img src="https://raw.githubusercontent.com/Evandoz/blob/master/flow.ci/flow.ci003.png" alt="选择模板"><span class="caption">选择模板</span></p>
<h3 id="设置触发器"><a class="headerlink" href="#设置触发器"></a>设置触发器</h3>
<p>设置自动部署触发器，因为我是把源代码放在放在分支 hexo 中，博客静态文件放在分支 master 中，所以我选设置为 push hexo 时触发。</p>
<p><img src="https://raw.githubusercontent.com/Evandoz/blob/master/flow.ci/flow.ci004.png" alt="触发器"><span class="caption">触发器</span></p>
<h3 id="配置工作流"><a class="headerlink" href="#配置工作流"></a>配置工作流</h3>
<p>配置工作流，这里我们把 <code>测试</code> 部分删掉，然后加上 <code>自定义脚本</code>。</p>
<p><img src="https://raw.githubusercontent.com/Evandoz/blob/master/flow.ci/flow.ci005.png" alt="自定义脚本"><span class="caption">自定义脚本</span></p>
<p>脚本参考代码如下</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 安装Hexo命令行工具</span>
flow_cmd "npm install hexo<span class="token punctuation">-</span>cli <span class="token punctuation">-</span>g" <span class="token punctuation">-</span><span class="token punctuation">-</span>echo

<span class="token comment"># 执行Hexo生成</span>
flow_cmd "hexo clean" <span class="token punctuation">-</span><span class="token punctuation">-</span>echo
flow_cmd "hexo g" <span class="token punctuation">-</span><span class="token punctuation">-</span>echo

<span class="token comment"># 执行Hexo推送，这里没有使用 hexo d，因为没有权限</span>
flow_cmd "cd ./public" <span class="token punctuation">-</span><span class="token punctuation">-</span>echo
flow_cmd "git init" <span class="token punctuation">-</span><span class="token punctuation">-</span>echo
flow_cmd "git config user.name "your name" " <span class="token punctuation">-</span><span class="token punctuation">-</span>echo  <span class="token comment">#修改name</span>
flow_cmd "git config user.email "your email" " <span class="token punctuation">-</span><span class="token punctuation">-</span>echo  <span class="token comment">#修改email</span>
flow_cmd "git add ." <span class="token punctuation">-</span><span class="token punctuation">-</span>echo
flow_cmd "git commit <span class="token punctuation">-</span>m "site update" " <span class="token punctuation">-</span><span class="token punctuation">-</span>echo
flow_cmd "git push <span class="token punctuation">-</span><span class="token punctuation">-</span>force <span class="token punctuation">-</span><span class="token punctuation">-</span>quiet "git@git.coding.net<span class="token punctuation">:</span>your name/reponame.git" master<span class="token punctuation">:</span>master" <span class="token punctuation">-</span><span class="token punctuation">-</span>echo <span class="token comment"># 修改repo</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="配置-Token"><a class="headerlink" href="#配置-Token"></a>配置 Token</h3>
<p>我们创建项目后，<a target="_blank" rel="external nofollow noopener noreferrer" href="http://flow.ci">flow.ci</a> 会自动在 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://Coding.net">Coding.net</a> 中添加部署公钥，但是这个公钥只有只读权限，用于拉取（git clone）仓库代码，并没有推送权限。</p>
<p><img src="https://raw.githubusercontent.com/Evandoz/blob/master/flow.ci/flow.ci006.png" alt="flow.ci"><span class="caption">flow.ci</span></p>
<p>所以现在我们把它删除，重新添加这个公钥，并勾选<code>推送功能</code>，这样这个公钥就拥有了推送回 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://Coding.net">Coding.net</a> 的权限了，提高了安全性。</p>
<p><img src="https://raw.githubusercontent.com/Evandoz/blob/master/flow.ci/flow.ci007.png" alt="coding.net"><span class="caption">coding.net</span></p>
<h3 id="测试"><a class="headerlink" href="#测试"></a>测试</h3>
<p>配置完后可以手动创建来测试一下是否成功，如不成功可以查看构建日志来查找不成功的原因。</p>
<p><img src="https://raw.githubusercontent.com/Evandoz/blob/master/flow.ci/flow.ci008.png" alt="手动创建"><span class="caption">手动创建</span></p>
<h2 id="总结"><a class="headerlink" href="#总结"></a>总结</h2>
<hr>
<p>本文所提供自动部署 Hexo 方法解决了代码库安全性问题。如此便可专注于写好文章，构建部署就全交给 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://flow.ci">flow.ci</a> 完成。</p>

          </div>
          <div class="post-footer">
            <div class="post-copyright">&copy; 除特殊声明外，文章著作权归作者所有，转载请注明作者及出处</div>
          </div>
        </article>
        <!-- Pagination -->
        
          <div class="nagination card">
            
              <a href="/Notes/archives/5b0e76c5b78e" class="nagination-link">上篇: 马踏棋盘（骑士周游）</a>
            
            
              <a href="/Notes/archives/f65c0d2f3625" class="nagination-link">下篇: 空数据段引发的问题及思考</a>
            
          </div>
        
        <!-- Comment -->
        <!-- 
          <div id="article-comment" class="article-comment card"></div>

         -->
      </div>
      <div id="toc" class="toc">
        
          <ol class="toc-content"><li class="toc-content-item toc-content-level-2"><a class="toc-content-link" href="#%E8%AE%A4%E8%AF%86-flow-ci"><span class="toc-content-text">认识 flow.ci</span></a></li><li class="toc-content-item toc-content-level-2"><a class="toc-content-link" href="#%E9%85%8D%E7%BD%AE%E6%AD%A5%E9%AA%A4"><span class="toc-content-text">配置步骤</span></a><ol class="toc-content-child"><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#%E6%B3%A8%E5%86%8C-flow-ci"><span class="toc-content-text">注册 flow.ci</span></a></li><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-content-text">创建项目</span></a></li><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#%E8%AE%BE%E7%BD%AE%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-content-text">设置触发器</span></a></li><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#%E9%85%8D%E7%BD%AE%E5%B7%A5%E4%BD%9C%E6%B5%81"><span class="toc-content-text">配置工作流</span></a></li><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#%E9%85%8D%E7%BD%AE-Token"><span class="toc-content-text">配置 Token</span></a></li><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-content-text">测试</span></a></li></ol></li><li class="toc-content-item toc-content-level-2"><a class="toc-content-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-content-text">总结</span></a></li></ol>
        
      </div>
    </section>


</div>
        <footer id="footer" class="footer">
  <div class="outer">
    <div class="copyright">
      <p><span>EXP Notes</span> &copy; 2015 - 2022</p>
    </div>
    <div class="navigation">
      <a href="https://evandoz.github.io">Hexo · Levan</a>
    </div>
  </div>
</footer>

      </div>
    </div>
  </div>
  
  <div id="mobile-nav" class="mobile-nav">
  
    <a class="menu-item" href="/Notes/archives">归档</a>
  
    <a class="menu-item" href="/Notes/categories">分类</a>
  
    <a class="menu-item" href="/Notes/tags">标签</a>
  
    <a class="menu-item" href="/Notes/about">关于</a>
  
</div>

<div id="over-layer" class="over-layer"></div>

  
<script src="/Notes/js/jquery.js"></script>


<script src="/Notes/js/velocity.js"></script>


<script src="/Notes/js/plugins.js"></script>


<script src="/Notes/js/script.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->




</body>
</html>
